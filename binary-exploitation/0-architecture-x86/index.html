
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Bring you offensive spirit to the next level">
      
      
      
        <link rel="canonical" href="https://s-lck.github.io/HolisticPwning/binary-exploitation/0-architecture-x86/">
      
      
        <link rel="prev" href="../..">
      
      
        <link rel="next" href="../1-stack-overflow/">
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.14">
    
    
      
        <title>Architecture et debugger - Holistic Pwning</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.342714a4.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../custom.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
      
        <meta  property="og:type"  content="website" >
      
        <meta  property="og:title"  content="Architecture et debugger - Holistic Pwning" >
      
        <meta  property="og:description"  content="Bring you offensive spirit to the next level" >
      
        <meta  property="og:image"  content="https://s-lck.github.io/HolisticPwning/assets/images/social/binary-exploitation/0-architecture-x86.png" >
      
        <meta  property="og:image:type"  content="image/png" >
      
        <meta  property="og:image:width"  content="1200" >
      
        <meta  property="og:image:height"  content="630" >
      
        <meta  property="og:url"  content="https://s-lck.github.io/HolisticPwning/binary-exploitation/0-architecture-x86/" >
      
        <meta  name="twitter:card"  content="summary_large_image" >
      
        <meta  name="twitter:title"  content="Architecture et debugger - Holistic Pwning" >
      
        <meta  name="twitter:description"  content="Bring you offensive spirit to the next level" >
      
        <meta  name="twitter:image"  content="https://s-lck.github.io/HolisticPwning/assets/images/social/binary-exploitation/0-architecture-x86.png" >
      
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="brown" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#architecture-et-debugger" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Holistic Pwning" class="md-header__button md-logo" aria-label="Holistic Pwning" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Holistic Pwning
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Architecture et debugger
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="brown" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="brown" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
          <a href="javascript:void(0)" class="md-search__icon md-icon" title="Share" aria-label="Share" data-clipboard data-clipboard-text="" data-md-component="search-share" tabindex="-1">
            
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"/></svg>
          </a>
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/s-lck/HolisticPwning" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Holistic Pwning" class="md-nav__button md-logo" aria-label="Holistic Pwning" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Holistic Pwning
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/s-lck/HolisticPwning" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Holistic Pwning
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Binary exploitation
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Binary exploitation
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Architecture et debugger
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Architecture et debugger
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#architecture-x86" class="md-nav__link">
    <span class="md-ellipsis">
      Architecture x86
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Architecture x86">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#la-memoire" class="md-nav__link">
    <span class="md-ellipsis">
      La mémoire
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#la-pile" class="md-nav__link">
    <span class="md-ellipsis">
      La pile
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#conventions-dappels" class="md-nav__link">
    <span class="md-ellipsis">
      Conventions d'appels
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#retours-de-fonction" class="md-nav__link">
    <span class="md-ellipsis">
      Retours de fonction
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#les-registres-du-cpu" class="md-nav__link">
    <span class="md-ellipsis">
      Les registres du CPU
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Les registres du CPU">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#esp-pointeur-de-pile" class="md-nav__link">
    <span class="md-ellipsis">
      ESP : Pointeur de pile
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ebp-pointeur-de-base" class="md-nav__link">
    <span class="md-ellipsis">
      EBP : Pointeur de base
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#eip-pointeur-dinstructions" class="md-nav__link">
    <span class="md-ellipsis">
      EIP : Pointeur d'instructions
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windows-debugger" class="md-nav__link">
    <span class="md-ellipsis">
      Windows Debugger
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Windows Debugger">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#les-symboles" class="md-nav__link">
    <span class="md-ellipsis">
      Les symboles
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#acceder-et-manipuler-la-memoire" class="md-nav__link">
    <span class="md-ellipsis">
      Accéder et manipuler la mémoire
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lire-la-memoire" class="md-nav__link">
    <span class="md-ellipsis">
      Lire la mémoire
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#afficher-les-structures-en-memoire" class="md-nav__link">
    <span class="md-ellipsis">
      Afficher les structures en mémoire
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#les-pseudo-registres" class="md-nav__link">
    <span class="md-ellipsis">
      Les pseudo-registres
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ecrire-en-memoire" class="md-nav__link">
    <span class="md-ellipsis">
      Écrire en mémoire
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chercher-en-memoire" class="md-nav__link">
    <span class="md-ellipsis">
      Chercher en mémoire
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#inspecter-et-editer-les-registres" class="md-nav__link">
    <span class="md-ellipsis">
      Inspecter et éditer les registres
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#les-points-darret" class="md-nav__link">
    <span class="md-ellipsis">
      Les points d'arrêt
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Les points d&#39;arrêt">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#points-darrets-logiciels" class="md-nav__link">
    <span class="md-ellipsis">
      Points d'arrêts logiciels
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fonctions-non-resolues" class="md-nav__link">
    <span class="md-ellipsis">
      Fonctions non résolues
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#points-darrets-automatiques" class="md-nav__link">
    <span class="md-ellipsis">
      Points d'arrêts automatiques
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#points-darrets-materiels" class="md-nav__link">
    <span class="md-ellipsis">
      Points d'arrêts matériels
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lister-les-modules" class="md-nav__link">
    <span class="md-ellipsis">
      Lister les modules
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#operations-mathematiques" class="md-nav__link">
    <span class="md-ellipsis">
      Opérations mathématiques
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formats-de-donnees" class="md-nav__link">
    <span class="md-ellipsis">
      Formats de données
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#les-protections-memoire" class="md-nav__link">
    <span class="md-ellipsis">
      Les protections mémoire
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Les protections mémoire">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#data-execution-prevention" class="md-nav__link">
    <span class="md-ellipsis">
      Data Execution Prevention
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aslr" class="md-nav__link">
    <span class="md-ellipsis">
      ASLR
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cfg" class="md-nav__link">
    <span class="md-ellipsis">
      CFG
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../1-stack-overflow/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Stack Overflow
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../2-seh-overflow/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    SEH Overflow
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../3-egghunters/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Egg Hunters
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Write up
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Write up
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../write-up/NSEC24_Photographic-Memory-System/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    NSEC24 : Photographic Memory System
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../write-up/NSEC25_Fuel-Management-System/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    NSEC25 : Fuel Management System
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#architecture-x86" class="md-nav__link">
    <span class="md-ellipsis">
      Architecture x86
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Architecture x86">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#la-memoire" class="md-nav__link">
    <span class="md-ellipsis">
      La mémoire
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#la-pile" class="md-nav__link">
    <span class="md-ellipsis">
      La pile
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#conventions-dappels" class="md-nav__link">
    <span class="md-ellipsis">
      Conventions d'appels
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#retours-de-fonction" class="md-nav__link">
    <span class="md-ellipsis">
      Retours de fonction
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#les-registres-du-cpu" class="md-nav__link">
    <span class="md-ellipsis">
      Les registres du CPU
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Les registres du CPU">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#esp-pointeur-de-pile" class="md-nav__link">
    <span class="md-ellipsis">
      ESP : Pointeur de pile
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ebp-pointeur-de-base" class="md-nav__link">
    <span class="md-ellipsis">
      EBP : Pointeur de base
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#eip-pointeur-dinstructions" class="md-nav__link">
    <span class="md-ellipsis">
      EIP : Pointeur d'instructions
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windows-debugger" class="md-nav__link">
    <span class="md-ellipsis">
      Windows Debugger
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Windows Debugger">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#les-symboles" class="md-nav__link">
    <span class="md-ellipsis">
      Les symboles
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#acceder-et-manipuler-la-memoire" class="md-nav__link">
    <span class="md-ellipsis">
      Accéder et manipuler la mémoire
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lire-la-memoire" class="md-nav__link">
    <span class="md-ellipsis">
      Lire la mémoire
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#afficher-les-structures-en-memoire" class="md-nav__link">
    <span class="md-ellipsis">
      Afficher les structures en mémoire
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#les-pseudo-registres" class="md-nav__link">
    <span class="md-ellipsis">
      Les pseudo-registres
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ecrire-en-memoire" class="md-nav__link">
    <span class="md-ellipsis">
      Écrire en mémoire
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chercher-en-memoire" class="md-nav__link">
    <span class="md-ellipsis">
      Chercher en mémoire
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#inspecter-et-editer-les-registres" class="md-nav__link">
    <span class="md-ellipsis">
      Inspecter et éditer les registres
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#les-points-darret" class="md-nav__link">
    <span class="md-ellipsis">
      Les points d'arrêt
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Les points d&#39;arrêt">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#points-darrets-logiciels" class="md-nav__link">
    <span class="md-ellipsis">
      Points d'arrêts logiciels
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fonctions-non-resolues" class="md-nav__link">
    <span class="md-ellipsis">
      Fonctions non résolues
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#points-darrets-automatiques" class="md-nav__link">
    <span class="md-ellipsis">
      Points d'arrêts automatiques
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#points-darrets-materiels" class="md-nav__link">
    <span class="md-ellipsis">
      Points d'arrêts matériels
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lister-les-modules" class="md-nav__link">
    <span class="md-ellipsis">
      Lister les modules
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#operations-mathematiques" class="md-nav__link">
    <span class="md-ellipsis">
      Opérations mathématiques
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formats-de-donnees" class="md-nav__link">
    <span class="md-ellipsis">
      Formats de données
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#les-protections-memoire" class="md-nav__link">
    <span class="md-ellipsis">
      Les protections mémoire
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Les protections mémoire">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#data-execution-prevention" class="md-nav__link">
    <span class="md-ellipsis">
      Data Execution Prevention
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aslr" class="md-nav__link">
    <span class="md-ellipsis">
      ASLR
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cfg" class="md-nav__link">
    <span class="md-ellipsis">
      CFG
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="architecture-et-debugger">Architecture et debugger</h1>
<h2 id="architecture-x86">Architecture x86</h2>
<h3 id="la-memoire">La mémoire</h3>
<p>Quand un programme est exécuté, il alloue de la mémoire en respectant les limites imposées par le système.</p>
<p>Allocation de la mémoire dans Windows entre l'adresse mémoire la plus basse <code>0x00000000</code> et l'adresse mémoire la plus haute <code>0x7FFFFFFF</code> :</p>
<p align="center">
  <img src="https://raw.githubusercontent.com/s-lck/HolisticPwning/main/assets/architecture_x86_01.png">
</p>

<h3 id="la-pile">La pile</h3>
<p>Quand un <em>thread</em> est en cours d'exécution, il a besoin d'une zone de stockage de donnée à court terme pour :</p>
<ul>
<li>les fonctions</li>
<li>les variables locales</li>
<li>les informations de contrôle du programme</li>
</ul>
<p>C'est dans la pile (<em>stack</em>) que ces éléments sont stockés.</p>
<p>Pour simplifier l'exécution <em>multi-thread</em> chaque <em>thread</em> dans une même application utilise une pile différente.</p>
<p>La pile est vue par le CPU comme une mémoire de structure <code>Last-In, First-Out (LIFO)</code> :</p>
<ul>
<li>Les éléments déposés (<code>pushed</code>) en haut de la pile sont supprimés (<code>popped</code>) en premier</li>
<li>L'architecture x86 implémente deux instructions Assembleur dédiées<ul>
<li><code>PUSH</code> : Ajout dans le pile</li>
<li><code>POP</code> : Retrait de la pile</li>
</ul>
</li>
</ul>
<h3 id="conventions-dappels">Conventions d'appels</h3>
<p>Les conventions d'appels décrivent comment les fonctions reçoivent leurs paramètres depuis leur appelant et comment elles renvoient leur résultat.</p>
<p>L'architecture offre plusieurs conventions d'appels dont les différences sont liées à :</p>
<ul>
<li>Comment les paramètres et la valeur de retour sont envoyés :<ul>
<li>Registres CPU</li>
<li>Déposé sur la pile</li>
<li>Les deux</li>
</ul>
</li>
<li>Dans quel ordre sont passés les paramètres</li>
<li>Comment la pile est préparée et nettoyée après l'appel</li>
<li>Quels registres CPU la fonction appelée doit conserver pour l'appelant</li>
</ul>
<p>Généralement, le compilateur détermine quelle convention d'appel est utilisée pour toutes les fonctions d'un programme. <code>cdecl</code> est un exemple de conventions d'appel.</p>
<h3 id="retours-de-fonction">Retours de fonction</h3>
<p>Quand du code au sein d'un <code>thread</code> appelle une fonction il doit connaitre son adresse de retour pour revenir au code appelant une fois la fonction complétée.</p>
<p>L'adresse de retour est stockée dans la pile :</p>
<ul>
<li>Avec les paramètres de la fonction</li>
<li>Ainsi que les variables locales</li>
</ul>
<p>Ces données sont associées à un appel de fonction et sont stockées dans une section de la <code>stack</code> nommée <code>stack frame</code>.</p>
<p align="center">
  <img src="https://raw.githubusercontent.com/s-lck/HolisticPwning/main/assets/architecture_x86_02.png">
</p>

<p>Quand une fonction se termine, l'adresse de retour est récupérée depuis la pile et utilisée pour restaurer le flot d'exécution de la fonction appelante.</p>
<h3 id="les-registres-du-cpu">Les registres du CPU</h3>
<p>Les registres sont de tout petits et très rapides espaces mémoire permettant de lire et manipuler rapidement les données.</p>
<p>Dans une architecture 32 bits, le CPU utilise 9 registres de 32 bits.</p>
<p align="center">
  <img src="https://raw.githubusercontent.com/s-lck/HolisticPwning/main/assets/architecture_x86_03.png">
</p>

<p>Les noms ont étaient définis pour l'architecture 16 bits et ont ensuite été étendus pour les plates-formes 32 bits avec la lettre <code>E</code>.</p>
<p>Chaque registre peut contenir une valeur de 32 bits entre <code>0x00000000</code> et <code>0xFFFFFFFF</code> ou bien 16 bits ou 8 bits dans les sous-registres associés.</p>
<p align="center">
  <img src="https://raw.githubusercontent.com/s-lck/HolisticPwning/main/assets/architecture_x86_04.png">
</p>

<ul>
<li><code>EAX</code> : <em>Accumulator</em> : Opérations logiques et arithmétiques</li>
<li><code>EBX</code> : <em>Base</em> : Pointeur de base adresse mémoire</li>
<li><code>ECX</code> : <em>Counter</em> : Boucle, déplacement, rotation</li>
<li><code>EDX</code> : <em>Data</em> : <em>Input/Output</em>, multiplication, division</li>
<li><code>ESI</code> : <em>Source Index</em> : <em>Pointer addressing of data and source in string copy operations</em></li>
<li><code>EDI</code> : <em>Destination Index</em> : <em>Pointer addressing of data and destination in string copy operations</em></li>
</ul>
<h4 id="esp-pointeur-de-pile">ESP : Pointeur de pile</h4>
<p>La pile permet de stocker des données, des pointeurs et des arguments. La pile évolue en permanence durant l'exécution du programme.</p>
<p>Le pointeur de pile permet de suivre l'évolution de la localisation la plus récente de la pile. Il pointe sur le haut de la pile.</p>
<div class="admonition info">
<p class="admonition-title">Pointeur</p>
<p>Un pointeur est une référence vers une adresse en mémoire. Quand on dit qu'un registre contient un pointeur ou pointe sur adresse, cela veut dire que le registre contient l'adresse ciblée.</p>
</div>
<h4 id="ebp-pointeur-de-base">EBP : Pointeur de base</h4>
<p>La pile évolue constamment. Il peut devenir compliqué pour une fonction de suivre sa <code>stack frame</code> qui contient les arguments requis, les variables locales et l'adresse de retour.</p>
<p><code>EBP</code> va pointer sur le haut de la pile quand la fonction est appelée. La fonction va ensuite pouvoir utiliser <code>EBP</code> pour référencer les informations via <em>offset</em>.</p>
<p>Chaque bloc est sur 4 octets :</p>
<ul>
<li>Si on est a 2 blocs de EBP : <code>[ebp] + 8</code></li>
<li>Si on est a 4 blocs de EBP :  <code>[ebp] + 12</code></li>
</ul>
<h4 id="eip-pointeur-dinstructions">EIP : Pointeur d'instructions</h4>
<p>Un des registres les plus importants. Ce registre pointe toujours vers la prochaine instruction de code à exécuter.</p>
<p><code>EIP</code> permet de gérer le flot du programme, c'est la cible principale pour les dépassements de tampon.</p>
<h2 id="windows-debugger">Windows Debugger</h2>
<p>Il existe plusieurs outils de debug tel que :</p>
<ul>
<li>OllyDbg</li>
<li>Immunity Debugger</li>
<li>WinDBG</li>
</ul>
<p>Un debugger est un programme informatique inséré entre une application et le CPU. Un debugger agit comme un proxy. Il permet de voir et d'interagir avec la mémoire et le flot d'exécution.</p>
<p>Le CPU travaille avec du code binaire difficilement lisible par un humain. Le langage <code>Assembleur</code> fournis un mappage d’un pour un entre le binaire et le langage de programmation. Langage lisible par un humain.</p>
<div class="admonition info">
<p class="admonition-title">Opcode</p>
<p><code>Opcode</code> : Séquence binaire interprétée par le CPU comme une instruction précise.Le debugger affichera la valeur en hexadécimal et en langage assembleur.</p>
</div>
<p>Le debugger étudié ici est <code>WinDBG</code>.</p>
<h3 id="les-symboles">Les symboles</h3>
<p>Les fichiers de symboles permettent à WinDBG de référencer les fonctions et structures internes ainsi que les variables globales en utilisant des noms plutôt que des adresses.</p>
<p>On peut utiliser le fichier de symbole de Microsoft pour les exécutables Windows.</p>
<p>Les fichiers de symboles (<code>.PDB</code>) sont créés à la compilation par Microsoft de ses fichiers natifs. Microsoft ne fournit pas les fichiers de symbole pour chaque fichier. Les applications tierces peuvent avoir leur fichier <code>PDB</code>.</p>
<h3 id="acceder-et-manipuler-la-memoire">Accéder et manipuler la mémoire</h3>
<p>On peut afficher la traduction en assembleur d'une partie du code du programme avec la commande <code>u</code>. Elle permet de lire le code ASM des API Windows ou de n'importe quelle partie du programme en cours.</p>
<p>La commande <code>u</code> accepte :</p>
<ul>
<li>Une adresse mémoire</li>
<li>Une plage d'adresse (debut - fin)</li>
<li>Le nom d'une fonction (e.g. API Windows) via un symbole</li>
<li>S'il n'y a pas d'argument, le désassemblage commence dans l'EIP</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="n">0</span><span class="p">:</span><span class="n">006</span><span class="p">&gt;</span> <span class="n">u</span> <span class="n">kernel32</span><span class="p">!</span><span class="n">GetCurrentThread</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="n">KERNEL32</span><span class="p">!</span><span class="n">GetCurrentThread</span><span class="p">:</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="n">77732620</span> <span class="n">b8feffffff</span>      <span class="n">mov</span>     <span class="n">eax</span><span class="p">,</span><span class="n">0FFFFFFFEh</span>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="n">77732625</span> <span class="n">c3</span>              <span class="n">ret</span>
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="n">77732626</span> <span class="n">cc</span>              <span class="n">int</span>     <span class="n">3</span>
<a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a><span class="p">[...]</span>
</code></pre></div>
<h3 id="lire-la-memoire">Lire la mémoire</h3>
<p>On peut utiliser la commande <code>display</code> (<code>d</code>) suivit un indicateur de taille pour afficher le contenu de la mémoire :</p>
<ul>
<li><code>b</code> : <code>byte</code> : un <em>byte</em></li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="n">0</span><span class="p">:</span><span class="n">006</span><span class="p">&gt;</span> <span class="n">db</span> <span class="n">esp</span>
<a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a><span class="n">07e2fa5c</span>  <span class="n">f9</span> <span class="n">9b</span> <span class="n">87</span> <span class="n">77</span> <span class="n">bf</span> <span class="n">ba</span> <span class="n">31</span> <span class="n">c3-c0</span> <span class="n">9b</span> <span class="n">87</span> <span class="n">77</span> <span class="n">c0</span> <span class="n">9b</span> <span class="n">87</span> <span class="n">77</span>  <span class="p">...</span><span class="n">w</span><span class="p">..</span><span class="n">1</span><span class="p">....</span><span class="n">w</span><span class="p">...</span><span class="n">w</span>
<a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a><span class="n">07e2fa6c</span>  <span class="n">00</span> <span class="n">00</span> <span class="n">00</span> <span class="n">00</span> <span class="n">60</span> <span class="n">fa</span> <span class="n">e2</span> <span class="n">07</span><span class="p">-</span><span class="n">00</span> <span class="n">00</span> <span class="n">00</span> <span class="n">00</span> <span class="n">d4</span> <span class="n">fa</span> <span class="n">e2</span> <span class="n">07</span>  <span class="p">....`...........</span>
<a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a><span class="p">[...]</span>
</code></pre></div>
<ul>
<li><code>w</code> : <code>word</code> : deux <em>bytes</em></li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="n">0</span><span class="p">:</span><span class="n">006</span><span class="p">&gt;</span> <span class="n">dw</span> <span class="n">esp</span>
<a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a><span class="n">07e2fa5c</span>  <span class="n">9bf9</span> <span class="n">7787</span> <span class="n">babf</span> <span class="n">c331</span> <span class="n">9bc0</span> <span class="n">7787</span> <span class="n">9bc0</span> <span class="n">7787</span>
<a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a><span class="n">07e2fa6c</span>  <span class="n">0000</span> <span class="n">0000</span> <span class="n">fa60</span> <span class="n">07e2</span> <span class="n">0000</span> <span class="n">0000</span> <span class="n">fad4</span> <span class="n">07e2</span>
<a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a><span class="p">[...]</span>
</code></pre></div>
<ul>
<li><code>d</code> : <code>dword</code> : quatre <em>bytes</em></li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="n">0</span><span class="p">:</span><span class="n">006</span><span class="p">&gt;</span> <span class="n">dd</span> <span class="n">esp</span>
<a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a><span class="n">07e2fa5c</span>  <span class="n">77879bf9</span> <span class="n">c331babf</span> <span class="n">77879bc0</span> <span class="n">77879bc0</span>
<a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a><span class="n">07e2fa6c</span>  <span class="n">00000000</span> <span class="n">07e2fa60</span> <span class="n">00000000</span> <span class="n">07e2fad4</span>
<a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a><span class="p">[...]</span>
</code></pre></div>
<ul>
<li><code>q</code> : <code>qword</code> : huit <em>bytes</em></li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="n">0</span><span class="p">:</span><span class="n">006</span><span class="p">&gt;</span> <span class="n">dq</span> <span class="n">07e2fa5c</span>
<a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a><span class="n">07e2fa5c</span>  <span class="n">c331babf</span><span class="p">`</span><span class="n">77879bf9</span> <span class="n">77879bc0</span><span class="p">`</span><span class="n">77879bc0</span>
<a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a><span class="n">07e2fa6c</span>  <span class="n">07e2fa60</span><span class="p">`</span><span class="n">00000000</span> <span class="n">07e2fad4</span><span class="p">`</span><span class="n">00000000</span>
<a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a><span class="p">[...]</span>
</code></pre></div>
<p>On peut choisir d'afficher les caractères <code>ASCII</code> :</p>
<ul>
<li><code>dc</code> : 4 octets et les caractères <code>ASCII</code></li>
<li><code>dW</code> : 2 octets et les caractères <code>ASCII</code></li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="n">0</span><span class="p">:</span><span class="n">006</span><span class="p">&gt;</span> <span class="n">dW</span> <span class="n">07e2fa5c</span>
<a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a><span class="n">07e2fa5c</span>  <span class="n">9bf9</span> <span class="n">7787</span> <span class="n">babf</span> <span class="n">c331</span> <span class="n">9bc0</span> <span class="n">7787</span> <span class="n">9bc0</span> <span class="n">7787</span>  <span class="p">...</span><span class="n">w</span><span class="p">..</span><span class="n">1</span><span class="p">....</span><span class="n">w</span><span class="p">...</span><span class="n">w</span>
<a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a><span class="n">07e2fa6c</span>  <span class="n">0000</span> <span class="n">0000</span> <span class="n">fa60</span> <span class="n">07e2</span> <span class="n">0000</span> <span class="n">0000</span> <span class="n">fad4</span> <span class="n">07e2</span>  <span class="p">....`...........</span>
<a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a><span class="p">[...]</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="n">0</span><span class="p">:</span><span class="n">006</span><span class="p">&gt;</span> <span class="n">dc</span> <span class="n">07e2fa5c</span>
<a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a><span class="n">07e2fa5c</span>  <span class="n">77879bf9</span> <span class="n">c331babf</span> <span class="n">77879bc0</span> <span class="n">77879bc0</span>  <span class="p">...</span><span class="n">w</span><span class="p">..</span><span class="n">1</span><span class="p">....</span><span class="n">w</span><span class="p">...</span><span class="n">w</span>
<a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a><span class="n">07e2fa6c</span>  <span class="n">00000000</span> <span class="n">07e2fa60</span> <span class="n">00000000</span> <span class="n">07e2fad4</span>  <span class="p">....`...........</span>
<a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a><span class="p">[...]</span>
</code></pre></div>
<p>La taille par défaut peut être modifiée avec le paramètre <code>L*</code>. La valeur qui va suivre <code>L</code> va influencer la quantité de données affichées.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a><span class="n">0</span><span class="p">:</span><span class="n">006</span><span class="p">&gt;</span> <span class="n">dW</span> <span class="n">esp</span> <span class="n">L10</span>
<a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a><span class="n">07e2fa5c</span>  <span class="n">9bf9</span> <span class="n">7787</span> <span class="n">babf</span> <span class="n">c331</span> <span class="n">9bc0</span> <span class="n">7787</span> <span class="n">9bc0</span> <span class="n">7787</span>  <span class="p">...</span><span class="n">w</span><span class="p">..</span><span class="n">1</span><span class="p">....</span><span class="n">w</span><span class="p">...</span><span class="n">w</span>
<a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a><span class="n">07e2fa6c</span>  <span class="n">0000</span> <span class="n">0000</span> <span class="n">fa60</span> <span class="n">07e2</span> <span class="n">0000</span> <span class="n">0000</span> <span class="n">fad4</span> <span class="n">07e2</span>  <span class="p">....`...........</span>
<a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a><span class="c">#</span>
<a id="__codelineno-7-5" name="__codelineno-7-5" href="#__codelineno-7-5"></a><span class="n">0</span><span class="p">:</span><span class="n">006</span><span class="p">&gt;</span> <span class="n">dW</span> <span class="n">esp</span> <span class="n">L2</span>
<a id="__codelineno-7-6" name="__codelineno-7-6" href="#__codelineno-7-6"></a><span class="n">07e2fa5c</span>  <span class="n">9bf9</span> <span class="n">7787</span>                                <span class="p">...</span><span class="n">w</span>
<a id="__codelineno-7-7" name="__codelineno-7-7" href="#__codelineno-7-7"></a><span class="c">#</span>
<a id="__codelineno-7-8" name="__codelineno-7-8" href="#__codelineno-7-8"></a><span class="n">0</span><span class="p">:</span><span class="n">006</span><span class="p">&gt;</span> <span class="n">dW</span> <span class="n">esp</span> <span class="n">L1</span>
<a id="__codelineno-7-9" name="__codelineno-7-9" href="#__codelineno-7-9"></a><span class="n">07e2fa5c</span>  <span class="n">9bf9</span>                                     <span class="p">..</span>
</code></pre></div>
<p>La commande <code>poi()</code> affiche le contenu de l'adresse contenu dans le registre :</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a><span class="n">0</span><span class="p">:</span><span class="n">006</span><span class="p">&gt;</span> <span class="n">dd</span> <span class="n">esp</span> <span class="n">L1</span>
<a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a><span class="n">07e2fa5c</span>  <span class="n">77879bf9</span>
<a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a><span class="c">#</span>
<a id="__codelineno-8-4" name="__codelineno-8-4" href="#__codelineno-8-4"></a><span class="n">0</span><span class="p">:</span><span class="n">006</span><span class="p">&gt;</span> <span class="n">dd</span> <span class="n">77879bf9</span>
<a id="__codelineno-8-5" name="__codelineno-8-5" href="#__codelineno-8-5"></a><span class="n">77879bf9</span>  <span class="n">c03307eb</span> <span class="n">658bc340</span> <span class="n">fc45c7e8</span> <span class="n">fffffffe</span>
<a id="__codelineno-8-6" name="__codelineno-8-6" href="#__codelineno-8-6"></a><span class="n">77879c09</span>  <span class="n">e0e8006a</span> <span class="n">ccfff98d</span> <span class="n">cccccccc</span> <span class="n">cccccccc</span>
</code></pre></div>
<p>Est équivalent à :</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a><span class="n">0</span><span class="p">:</span><span class="n">006</span><span class="p">&gt;</span> <span class="n">dd</span> <span class="n">poi</span><span class="p">(</span><span class="n">esp</span><span class="p">)</span>
<a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a><span class="n">77879bf9</span>  <span class="n">c03307eb</span> <span class="n">658bc340</span> <span class="n">fc45c7e8</span> <span class="n">fffffffe</span>
<a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a><span class="n">77879c09</span>  <span class="n">e0e8006a</span> <span class="n">ccfff98d</span> <span class="n">cccccccc</span> <span class="n">cccccccc</span>
</code></pre></div>
<h3 id="afficher-les-structures-en-memoire">Afficher les structures en mémoire</h3>
<p>Les structures sont un concept de programmation qui combine différents types de données. Elles sont faciles à lire avant la compilation, après la compilation le code est traduit en valeur binaire et devient compliqué à lire.</p>
<ul>
<li>La commande <code>display</code> peut permettre d'afficher des structures</li>
<li>La commande <code>Display Table</code> (<code>dt</code>) prends le nom de la structure à afficher</li>
</ul>
<p>Affichage de la structure <code>Thread Environment Block</code> (<code>TEB</code>) :</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a><span class="n">0</span><span class="p">:</span><span class="n">006</span><span class="p">&gt;</span> <span class="n">dt</span> <span class="n">ntdll</span><span class="p">!</span><span class="n">_TEB</span>
<a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a>   <span class="p">+</span><span class="n">0x000</span> <span class="n">NtTib</span>            <span class="p">:</span> <span class="n">_NT_TIB</span>
<a id="__codelineno-10-3" name="__codelineno-10-3" href="#__codelineno-10-3"></a>   <span class="p">+</span><span class="n">0x01c</span> <span class="n">EnvironmentPointer</span> <span class="p">:</span> <span class="n">Ptr32</span> <span class="n">Void</span>
<a id="__codelineno-10-4" name="__codelineno-10-4" href="#__codelineno-10-4"></a>   <span class="p">+</span><span class="n">0x020</span> <span class="n">ClientId</span>         <span class="p">:</span> <span class="n">_CLIENT_ID</span>
<a id="__codelineno-10-5" name="__codelineno-10-5" href="#__codelineno-10-5"></a>   <span class="p">+</span><span class="n">0x028</span> <span class="n">ActiveRpcHandle</span>  <span class="p">:</span> <span class="n">Ptr32</span> <span class="n">Void</span>
<a id="__codelineno-10-6" name="__codelineno-10-6" href="#__codelineno-10-6"></a>   <span class="p">+</span><span class="n">0x02c</span> <span class="n">ThreadLocalStoragePointer</span> <span class="p">:</span> <span class="n">Ptr32</span> <span class="n">Void</span>
<a id="__codelineno-10-7" name="__codelineno-10-7" href="#__codelineno-10-7"></a>   <span class="p">+</span><span class="n">0x030</span> <span class="n">ProcessEnvironmentBlock</span> <span class="p">:</span> <span class="n">Ptr32</span> <span class="n">_PEB</span>
<a id="__codelineno-10-8" name="__codelineno-10-8" href="#__codelineno-10-8"></a>   <span class="p">+</span><span class="n">0x034</span> <span class="n">LastErrorValue</span>   <span class="p">:</span> <span class="n">Uint4B</span>
<a id="__codelineno-10-9" name="__codelineno-10-9" href="#__codelineno-10-9"></a><span class="p">[...]</span>
</code></pre></div>
<p>La commande affiche les champs, leur type et leur offset. Il est possible qu'un champ de la structure pointe sur une deuxième structure, exemple <code>NtTib : _NT_TIB</code>. On peut utiliser <code>-r</code> pour afficher les structures de manières récursives.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a><span class="n">0</span><span class="p">:</span><span class="n">006</span><span class="p">&gt;</span> <span class="n">dt</span> <span class="n">-r</span> <span class="n">ntdll</span><span class="p">!</span><span class="n">_TEB</span>
<a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a>   <span class="p">+</span><span class="n">0x000</span> <span class="n">NtTib</span>            <span class="p">:</span> <span class="n">_NT_TIB</span>
<a id="__codelineno-11-3" name="__codelineno-11-3" href="#__codelineno-11-3"></a>      <span class="p">+</span><span class="n">0x000</span> <span class="n">ExceptionList</span>    <span class="p">:</span> <span class="n">Ptr32</span> <span class="n">_EXCEPTION_REGISTRATION_RECORD</span>
<a id="__codelineno-11-4" name="__codelineno-11-4" href="#__codelineno-11-4"></a>         <span class="p">+</span><span class="n">0x000</span> <span class="n">Next</span>             <span class="p">:</span> <span class="n">Ptr32</span> <span class="n">_EXCEPTION_REGISTRATION_RECORD</span>
<a id="__codelineno-11-5" name="__codelineno-11-5" href="#__codelineno-11-5"></a>         <span class="p">+</span><span class="n">0x004</span> <span class="n">Handler</span>          <span class="p">:</span> <span class="n">Ptr32</span>           <span class="n">_EXCEPTION_DISPOSITION</span> 
<a id="__codelineno-11-6" name="__codelineno-11-6" href="#__codelineno-11-6"></a>      <span class="p">+</span><span class="n">0x004</span> <span class="n">StackBase</span>        <span class="p">:</span> <span class="n">Ptr32</span> <span class="n">Void</span>
<a id="__codelineno-11-7" name="__codelineno-11-7" href="#__codelineno-11-7"></a><span class="p">[...]</span>
<a id="__codelineno-11-8" name="__codelineno-11-8" href="#__codelineno-11-8"></a>      <span class="p">+</span><span class="n">0x010</span> <span class="n">Version</span>          <span class="p">:</span> <span class="n">Uint4B</span>
<a id="__codelineno-11-9" name="__codelineno-11-9" href="#__codelineno-11-9"></a>      <span class="p">+</span><span class="n">0x014</span> <span class="n">ArbitraryUserPointer</span> <span class="p">:</span> <span class="n">Ptr32</span> <span class="n">Void</span>
<a id="__codelineno-11-10" name="__codelineno-11-10" href="#__codelineno-11-10"></a>      <span class="p">+</span><span class="n">0x018</span> <span class="n">Self</span>             <span class="p">:</span> <span class="n">Ptr32</span> <span class="n">_NT_TIB</span>
<a id="__codelineno-11-11" name="__codelineno-11-11" href="#__codelineno-11-11"></a>         <span class="p">+</span><span class="n">0x000</span> <span class="n">ExceptionList</span>    <span class="p">:</span> <span class="n">Ptr32</span> <span class="n">_EXCEPTION_REGISTRATION_RECORD</span>
<a id="__codelineno-11-12" name="__codelineno-11-12" href="#__codelineno-11-12"></a>         <span class="p">+</span><span class="n">0x004</span> <span class="n">StackBase</span>        <span class="p">:</span> <span class="n">Ptr32</span> <span class="n">Void</span>
<a id="__codelineno-11-13" name="__codelineno-11-13" href="#__codelineno-11-13"></a><span class="p">[...]</span>
<a id="__codelineno-11-14" name="__codelineno-11-14" href="#__codelineno-11-14"></a>   <span class="p">+</span><span class="n">0x01c</span> <span class="n">EnvironmentPointer</span> <span class="p">:</span> <span class="n">Ptr32</span> <span class="n">Void</span>
</code></pre></div>
<h3 id="les-pseudo-registres">Les pseudo-registres</h3>
<p>Les pseudo-registres sont des variables spécifiques au sein de WinDbg qui peuvent être utilisées notamment durant les opérations de calculs.</p>
<ul>
<li><code>$teb</code> est un pseudo-registre qui contient l'adresse du <code>TEB</code> du <em>thread</em> courant, on peut l'utiliser de cette manière :</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a><span class="n">0</span><span class="p">:</span><span class="n">006</span><span class="p">&gt;</span> <span class="n">dt</span> <span class="n">-r</span> <span class="n">ntdll</span><span class="p">!</span><span class="n">_TEB</span> <span class="p">@</span><span class="nv">$teb</span>
<a id="__codelineno-12-2" name="__codelineno-12-2" href="#__codelineno-12-2"></a>   <span class="p">+</span><span class="n">0x000</span> <span class="n">NtTib</span>            <span class="p">:</span> <span class="n">_NT_TIB</span>
<a id="__codelineno-12-3" name="__codelineno-12-3" href="#__codelineno-12-3"></a>      <span class="p">+</span><span class="n">0x000</span> <span class="n">ExceptionList</span>    <span class="p">:</span> <span class="n">0x0720fa50</span> <span class="n">_EXCEPTION_REGISTRATION_RECORD</span>
<a id="__codelineno-12-4" name="__codelineno-12-4" href="#__codelineno-12-4"></a>         <span class="p">+</span><span class="n">0x000</span> <span class="n">Next</span>             <span class="p">:</span> <span class="n">0x0720faac</span> <span class="n">_EXCEPTION_REGISTRATION_RECORD</span>
<a id="__codelineno-12-5" name="__codelineno-12-5" href="#__codelineno-12-5"></a>         <span class="p">+</span><span class="n">0x004</span> <span class="n">Handler</span>          <span class="p">:</span> <span class="n">0x77847390</span>           <span class="n">_EXCEPTION_DISPOSITION</span>  <span class="n">ntdll</span><span class="p">!</span><span class="n">_except_handler4</span><span class="p">+</span><span class="n">0</span>
<a id="__codelineno-12-6" name="__codelineno-12-6" href="#__codelineno-12-6"></a>      <span class="p">+</span><span class="n">0x004</span> <span class="n">StackBase</span>        <span class="p">:</span> <span class="n">0x07210000</span> <span class="n">Void</span>
<a id="__codelineno-12-7" name="__codelineno-12-7" href="#__codelineno-12-7"></a><span class="p">[...]</span>
<a id="__codelineno-12-8" name="__codelineno-12-8" href="#__codelineno-12-8"></a>      <span class="p">+</span><span class="n">0x014</span> <span class="n">ArbitraryUserPointer</span> <span class="p">:</span> <span class="p">(</span><span class="n">null</span><span class="p">)</span> 
<a id="__codelineno-12-9" name="__codelineno-12-9" href="#__codelineno-12-9"></a>      <span class="p">+</span><span class="n">0x018</span> <span class="n">Self</span>             <span class="p">:</span> <span class="n">0x00ead000</span> <span class="n">_NT_TIB</span>
<a id="__codelineno-12-10" name="__codelineno-12-10" href="#__codelineno-12-10"></a>         <span class="p">+</span><span class="n">0x000</span> <span class="n">ExceptionList</span>    <span class="p">:</span> <span class="n">0x0720fa50</span> <span class="n">_EXCEPTION_REGISTRATION_RECORD</span>
<a id="__codelineno-12-11" name="__codelineno-12-11" href="#__codelineno-12-11"></a><span class="p">[...]</span>
<a id="__codelineno-12-12" name="__codelineno-12-12" href="#__codelineno-12-12"></a>         <span class="p">+</span><span class="n">0x014</span> <span class="n">ArbitraryUserPointer</span> <span class="p">:</span> <span class="p">(</span><span class="n">null</span><span class="p">)</span> 
<a id="__codelineno-12-13" name="__codelineno-12-13" href="#__codelineno-12-13"></a>         <span class="p">+</span><span class="n">0x018</span> <span class="n">Self</span>             <span class="p">:</span> <span class="n">0x00ead000</span> <span class="n">_NT_TIB</span>
<a id="__codelineno-12-14" name="__codelineno-12-14" href="#__codelineno-12-14"></a>   <span class="p">+</span><span class="n">0x01c</span> <span class="n">EnvironmentPointer</span> <span class="p">:</span> <span class="p">(</span><span class="n">null</span><span class="p">)</span> 
<a id="__codelineno-12-15" name="__codelineno-12-15" href="#__codelineno-12-15"></a>   <span class="p">+</span><span class="n">0x020</span> <span class="n">ClientId</span>         <span class="p">:</span> <span class="n">_CLIENT_ID</span>
<a id="__codelineno-12-16" name="__codelineno-12-16" href="#__codelineno-12-16"></a><span class="p">[...]</span>
</code></pre></div>
<p>Il existe 20 pseudo-registres définis par défaut nomme de <code>$t0</code> à <code>$t19</code> qui peuvent être utilisé comme variable durant les opérations mathématiques.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a><span class="c"># Stockage de l&#39;addition dans $t0</span>
<a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a><span class="n">0</span><span class="p">:</span><span class="n">000</span><span class="p">&gt;</span> <span class="nb">r </span><span class="p">@</span><span class="nv">$t0</span> <span class="p">=</span> <span class="p">(</span><span class="n">41414141</span> <span class="p">+</span> <span class="n">41414141</span><span class="p">)</span>
<a id="__codelineno-13-3" name="__codelineno-13-3" href="#__codelineno-13-3"></a><span class="c"># Affichage de $t0</span>
<a id="__codelineno-13-4" name="__codelineno-13-4" href="#__codelineno-13-4"></a><span class="n">0</span><span class="p">:</span><span class="n">000</span><span class="p">&gt;</span> <span class="nb">r </span><span class="p">@</span><span class="nv">$t0</span>
<a id="__codelineno-13-5" name="__codelineno-13-5" href="#__codelineno-13-5"></a><span class="nv">$t0</span><span class="p">=</span><span class="n">82828282</span>
<a id="__codelineno-13-6" name="__codelineno-13-6" href="#__codelineno-13-6"></a><span class="c"># Stockage de la soustraction dans $t1</span>
<a id="__codelineno-13-7" name="__codelineno-13-7" href="#__codelineno-13-7"></a><span class="n">0</span><span class="p">:</span><span class="n">000</span><span class="p">&gt;</span> <span class="nb">r </span><span class="p">@</span><span class="nv">$t1</span> <span class="p">=</span> <span class="p">@</span><span class="nv">$t0</span> <span class="p">/</span> <span class="n">5</span>
<a id="__codelineno-13-8" name="__codelineno-13-8" href="#__codelineno-13-8"></a><span class="c"># Affichage de $t1</span>
<a id="__codelineno-13-9" name="__codelineno-13-9" href="#__codelineno-13-9"></a><span class="n">0</span><span class="p">:</span><span class="n">000</span><span class="p">&gt;</span> <span class="nb">r </span><span class="p">@</span><span class="nv">$t1</span>
<a id="__codelineno-13-10" name="__codelineno-13-10" href="#__codelineno-13-10"></a><span class="nv">$t1</span><span class="p">=</span><span class="n">1a1a1a1a</span>
</code></pre></div>
<h3 id="ecrire-en-memoire">Écrire en mémoire</h3>
<p>Il est aussi possible d'écrire en mémoire. La commande pour ce faire est <code>e*</code> avec <code>*</code> la taille à écrire :</p>
<ul>
<li><code>d</code> : <em>Dword</em></li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a><span class="c"># Lecture du registre ESP</span>
<a id="__codelineno-14-2" name="__codelineno-14-2" href="#__codelineno-14-2"></a><span class="n">0</span><span class="p">:</span><span class="n">006</span><span class="p">&gt;</span> <span class="n">dd</span> <span class="n">esp</span> <span class="n">L1</span>
<a id="__codelineno-14-3" name="__codelineno-14-3" href="#__codelineno-14-3"></a><span class="n">0720fa34</span>  <span class="n">77879bf9</span>
<a id="__codelineno-14-4" name="__codelineno-14-4" href="#__codelineno-14-4"></a><span class="c"># Ecriture du DWORD 41414141 dans le registre ESP</span>
<a id="__codelineno-14-5" name="__codelineno-14-5" href="#__codelineno-14-5"></a><span class="n">0</span><span class="p">:</span><span class="n">006</span><span class="p">&gt;</span> <span class="n">ed</span> <span class="n">esp</span> <span class="n">41414141</span>
<a id="__codelineno-14-6" name="__codelineno-14-6" href="#__codelineno-14-6"></a><span class="n">0</span><span class="p">:</span><span class="n">006</span><span class="p">&gt;</span> <span class="n">dd</span> <span class="n">esp</span> <span class="n">L1</span>
<a id="__codelineno-14-7" name="__codelineno-14-7" href="#__codelineno-14-7"></a><span class="n">0720fa34</span>  <span class="n">41414141</span>
</code></pre></div>
<ul>
<li><code>w</code> : <em>Word</em></li>
<li><code>a</code> : <em>ASCII string</em></li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a><span class="n">0</span><span class="p">:</span><span class="n">006</span><span class="p">&gt;</span> <span class="n">da</span> <span class="n">esp</span> <span class="n">L5</span>
<a id="__codelineno-15-2" name="__codelineno-15-2" href="#__codelineno-15-2"></a><span class="n">0720fa34</span>  <span class="s2">&quot;AAAA&quot;</span>
<a id="__codelineno-15-3" name="__codelineno-15-3" href="#__codelineno-15-3"></a><span class="n">0</span><span class="p">:</span><span class="n">006</span><span class="p">&gt;</span> <span class="n">ea</span> <span class="n">esp</span> <span class="s2">&quot;Hello&quot;</span>
<a id="__codelineno-15-4" name="__codelineno-15-4" href="#__codelineno-15-4"></a><span class="n">0</span><span class="p">:</span><span class="n">006</span><span class="p">&gt;</span> <span class="n">da</span> <span class="n">esp</span> <span class="n">L5</span>
<a id="__codelineno-15-5" name="__codelineno-15-5" href="#__codelineno-15-5"></a><span class="n">0720fa34</span>  <span class="s2">&quot;Hello&quot;</span>
</code></pre></div>
<h3 id="chercher-en-memoire">Chercher en mémoire</h3>
<p>Le développement d'exploit peut nécessiter la recherche dans l'espace mémoire pour un motif spécifique. WinDbg permet de chercher avec la commande <code>s</code>.</p>
<p>La commande prend 4 paramètres :</p>
<ul>
<li>Le type de mémoire dans lequel chercher</li>
<li>Le point de départ</li>
<li>La longueur sur laquelle chercher</li>
<li>Le motif à chercher</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a><span class="c"># Écriture</span>
<a id="__codelineno-16-2" name="__codelineno-16-2" href="#__codelineno-16-2"></a><span class="n">0</span><span class="p">:</span><span class="n">000</span><span class="p">&gt;</span> <span class="n">ed</span> <span class="n">esp</span> <span class="n">41414141</span>
<a id="__codelineno-16-3" name="__codelineno-16-3" href="#__codelineno-16-3"></a><span class="c"># Lecture</span>
<a id="__codelineno-16-4" name="__codelineno-16-4" href="#__codelineno-16-4"></a><span class="n">0</span><span class="p">:</span><span class="n">000</span><span class="p">&gt;</span> <span class="n">da</span> <span class="n">esp</span>
<a id="__codelineno-16-5" name="__codelineno-16-5" href="#__codelineno-16-5"></a><span class="n">0096f69c</span>  <span class="s2">&quot;AAAA.6|w&quot;</span>
<a id="__codelineno-16-6" name="__codelineno-16-6" href="#__codelineno-16-6"></a><span class="c"># Recherche</span>
<a id="__codelineno-16-7" name="__codelineno-16-7" href="#__codelineno-16-7"></a><span class="c">## On identifie bien `0096f69c` (adresse de ESP) dans la recherche - parmi d&#39;autres</span>
<a id="__codelineno-16-8" name="__codelineno-16-8" href="#__codelineno-16-8"></a><span class="n">0</span><span class="p">:</span><span class="n">000</span><span class="p">&gt;</span> <span class="n">s</span> <span class="n">-d</span> <span class="n">0</span> <span class="n">L</span><span class="k">?</span><span class="n">80000000</span> <span class="n">41414141</span>
<a id="__codelineno-16-9" name="__codelineno-16-9" href="#__codelineno-16-9"></a><span class="n">0096f69c</span>  <span class="n">41414141</span> <span class="n">777c36cc</span> <span class="n">00bca000</span> <span class="n">00000000</span>  <span class="n">AAAA</span><span class="p">.</span><span class="n">6</span><span class="p">|</span><span class="n">w</span><span class="p">........</span>
<a id="__codelineno-16-10" name="__codelineno-16-10" href="#__codelineno-16-10"></a><span class="n">67d23820</span>  <span class="n">41414141</span> <span class="n">db5e5e5e</span> <span class="n">b6b7b7db</span> <span class="n">b4b6b6b6</span>  <span class="n">AAAA</span><span class="p">^^^.........</span>
<a id="__codelineno-16-11" name="__codelineno-16-11" href="#__codelineno-16-11"></a><span class="n">6e804600</span>  <span class="n">41414141</span> <span class="n">00d5b7af</span> <span class="n">00000000</span> <span class="n">00000000</span>  <span class="n">AAAA</span><span class="p">............</span>
</code></pre></div>
<h3 id="inspecter-et-editer-les-registres">Inspecter et éditer les registres</h3>
<p>On peut accéder aux registres CPU via la commande <code>r</code>. Permets d'afficher et modifier les valeurs des registres.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a><span class="c"># Tout afficher</span>
<a id="__codelineno-17-2" name="__codelineno-17-2" href="#__codelineno-17-2"></a><span class="n">0</span><span class="p">:</span><span class="n">000</span><span class="p">&gt;</span> <span class="nb">r</span>
<a id="__codelineno-17-3" name="__codelineno-17-3" href="#__codelineno-17-3"></a><span class="n">eax</span><span class="p">=</span><span class="n">00000000</span> <span class="n">ebx</span><span class="p">=</span><span class="n">00000000</span> <span class="n">ecx</span><span class="p">=</span><span class="n">0096f680</span> <span class="n">edx</span><span class="p">=</span><span class="n">77841670</span> <span class="n">esi</span><span class="p">=</span><span class="n">00bca000</span> <span class="n">edi</span><span class="p">=</span><span class="n">777c36cc</span>
<a id="__codelineno-17-4" name="__codelineno-17-4" href="#__codelineno-17-4"></a><span class="n">eip</span><span class="p">=</span><span class="n">7787bb62</span> <span class="n">esp</span><span class="p">=</span><span class="n">0096f69c</span> <span class="n">ebp</span><span class="p">=</span><span class="n">0096f6c8</span> <span class="n">iopl</span><span class="p">=</span><span class="n">0</span>         <span class="nb">nv </span><span class="n">up</span> <span class="n">ei</span> <span class="n">pl</span> <span class="n">zr</span> <span class="n">na</span> <span class="n">pe</span> <span class="n">nc</span>
<a id="__codelineno-17-5" name="__codelineno-17-5" href="#__codelineno-17-5"></a><span class="n">cs</span><span class="p">=</span><span class="n">001b</span>  <span class="n">ss</span><span class="p">=</span><span class="n">0023</span>  <span class="n">ds</span><span class="p">=</span><span class="n">0023</span>  <span class="n">es</span><span class="p">=</span><span class="n">0023</span>  <span class="n">fs</span><span class="p">=</span><span class="n">003b</span>  <span class="n">gs</span><span class="p">=</span><span class="n">0000</span>             <span class="n">efl</span><span class="p">=</span><span class="n">00000246</span>
<a id="__codelineno-17-6" name="__codelineno-17-6" href="#__codelineno-17-6"></a><span class="n">ntdll</span><span class="p">!</span><span class="n">LdrpDoDebuggerBreak</span><span class="p">+</span><span class="n">0x2b</span><span class="p">:</span>
<a id="__codelineno-17-7" name="__codelineno-17-7" href="#__codelineno-17-7"></a><span class="n">7787bb62</span> <span class="n">cc</span>              <span class="n">int</span>     <span class="n">3</span>
<a id="__codelineno-17-8" name="__codelineno-17-8" href="#__codelineno-17-8"></a><span class="c"># Afficher un seul registre</span>
<a id="__codelineno-17-9" name="__codelineno-17-9" href="#__codelineno-17-9"></a><span class="n">0</span><span class="p">:</span><span class="n">000</span><span class="p">&gt;</span> <span class="nb">r </span><span class="n">ecx</span>
<a id="__codelineno-17-10" name="__codelineno-17-10" href="#__codelineno-17-10"></a><span class="n">ecx</span><span class="p">=</span><span class="n">0096f680</span>
<a id="__codelineno-17-11" name="__codelineno-17-11" href="#__codelineno-17-11"></a><span class="c"># Modifier un seul registre</span>
<a id="__codelineno-17-12" name="__codelineno-17-12" href="#__codelineno-17-12"></a><span class="n">0</span><span class="p">:</span><span class="n">000</span><span class="p">&gt;</span> <span class="nb">r </span><span class="n">edx</span>
<a id="__codelineno-17-13" name="__codelineno-17-13" href="#__codelineno-17-13"></a><span class="n">edx</span><span class="p">=</span><span class="n">77841670</span>
<a id="__codelineno-17-14" name="__codelineno-17-14" href="#__codelineno-17-14"></a><span class="n">0</span><span class="p">:</span><span class="n">000</span><span class="p">&gt;</span> <span class="nb">r </span><span class="n">edx</span><span class="p">=</span><span class="n">42424242</span>
<a id="__codelineno-17-15" name="__codelineno-17-15" href="#__codelineno-17-15"></a><span class="n">0</span><span class="p">:</span><span class="n">000</span><span class="p">&gt;</span> <span class="nb">r </span><span class="n">edx</span>
<a id="__codelineno-17-16" name="__codelineno-17-16" href="#__codelineno-17-16"></a><span class="n">edx</span><span class="p">=</span><span class="n">42424242</span>
</code></pre></div>
<h3 id="les-points-darret">Les points d'arrêt</h3>
<p>WinDBG permet de définir des <code>breakpoints</code> pour stopper l'exécution aux endroits voulus dans le code.</p>
<p>Il existe 2 types de points d'arrêts :</p>
<ul>
<li>Logiciel</li>
<li>Matériel</li>
</ul>
<h4 id="points-darrets-logiciels">Points d'arrêts logiciels</h4>
<p>Quand on positionne un point d'arrêt logiciel avec WinDBG il remplace temporairement le 1er <em>opcode</em> de l'instruction ou l'on veut s'arrêter avec une instruction assembleur <code>INT 3</code>. On peut en définir autant qu'on veut.</p>
<p>Définir un point d'arrêt sur l'API Win32 <code>WriteFile</code> :</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a><span class="n">bp</span> <span class="n">kernel32</span><span class="p">!</span><span class="n">WriteFile</span>
</code></pre></div>
<p>Puis on peut lister les BP avec <code>bl</code> :</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a><span class="n">0</span><span class="p">:</span><span class="n">006</span><span class="p">&gt;</span> <span class="n">bl</span>
<a id="__codelineno-19-2" name="__codelineno-19-2" href="#__codelineno-19-2"></a>     <span class="n">0</span> <span class="n">e</span> <span class="n">Disable</span> <span class="nb">Clear </span> <span class="n">7773c6d0</span>     <span class="n">0001</span> <span class="p">(</span><span class="n">0001</span><span class="p">)</span>  <span class="n">0</span><span class="p">:****</span> <span class="n">KERNEL32</span><span class="p">!</span><span class="n">WriteFile</span>
</code></pre></div>
<ul>
<li>On peut désactiver un point d'arrêt avec <code>bd</code></li>
<li>On utilise <code>bc</code> pour supprimer un point d'arrêt</li>
</ul>
<h4 id="fonctions-non-resolues">Fonctions non résolues</h4>
<p>On utilise la commande <code>bu</code> pour définir des points d'arrêts sur des fonctions <em>unresolved</em>. Fonction présente au sein d'un module qui n'est pas encore chargé dans l'espace mémoire d'un processus. Le point d'arrêt va être activé quand le module sera chargé et que la fonction cible sera résolue.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a><span class="c"># Chercher le module OLE32.dll</span>
<a id="__codelineno-20-2" name="__codelineno-20-2" href="#__codelineno-20-2"></a><span class="n">0</span><span class="p">:</span><span class="n">000</span><span class="p">&gt;</span> <span class="n">lm</span> <span class="n">m</span> <span class="n">ole32</span>
<a id="__codelineno-20-3" name="__codelineno-20-3" href="#__codelineno-20-3"></a><span class="n">Browse</span> <span class="n">full</span> <span class="n">module</span> <span class="n">list</span>
<a id="__codelineno-20-4" name="__codelineno-20-4" href="#__codelineno-20-4"></a><span class="nb">start </span>   <span class="k">end</span>        <span class="n">module</span> <span class="n">name</span>
<a id="__codelineno-20-5" name="__codelineno-20-5" href="#__codelineno-20-5"></a><span class="c"># Créer un point d&#39;arrêt unresolved sur la fonction `WriteStringStream` du module `OLE32`</span>
<a id="__codelineno-20-6" name="__codelineno-20-6" href="#__codelineno-20-6"></a><span class="n">0</span><span class="p">:</span><span class="n">000</span><span class="p">&gt;</span> <span class="n">bu</span> <span class="n">ole32</span><span class="p">!</span><span class="n">WriteStringStream</span>
<a id="__codelineno-20-7" name="__codelineno-20-7" href="#__codelineno-20-7"></a><span class="n">0</span><span class="p">:</span><span class="n">000</span><span class="p">&gt;</span> <span class="n">bl</span>
<a id="__codelineno-20-8" name="__codelineno-20-8" href="#__codelineno-20-8"></a>     <span class="n">0</span> <span class="n">e</span> <span class="n">Disable</span> <span class="nb">Clear </span><span class="n">u</span>             <span class="n">0001</span> <span class="p">(</span><span class="n">0001</span><span class="p">)</span> <span class="p">(</span><span class="n">ole32</span><span class="p">!</span><span class="n">WriteStringStream</span><span class="p">)</span>
<a id="__codelineno-20-9" name="__codelineno-20-9" href="#__codelineno-20-9"></a><span class="c"># On relance l&#39;exécution - On voit que le module `ole32` est chargé</span>
<a id="__codelineno-20-10" name="__codelineno-20-10" href="#__codelineno-20-10"></a><span class="n">0</span><span class="p">:</span><span class="n">000</span><span class="p">&gt;</span> <span class="n">g</span>
<a id="__codelineno-20-11" name="__codelineno-20-11" href="#__codelineno-20-11"></a><span class="n">ModLoad</span><span class="p">:</span> <span class="n">776e0000</span> <span class="n">77706000</span>   <span class="n">C</span><span class="p">:\</span><span class="n">Windows</span><span class="p">\</span><span class="n">System32</span><span class="p">\</span><span class="n">IMM32</span><span class="p">.</span><span class="n">DLL</span>
<a id="__codelineno-20-12" name="__codelineno-20-12" href="#__codelineno-20-12"></a><span class="p">[...]</span>
<a id="__codelineno-20-13" name="__codelineno-20-13" href="#__codelineno-20-13"></a><span class="n">ModLoad</span><span class="p">:</span> <span class="n">75fc0000</span> <span class="n">760b7000</span>   <span class="n">C</span><span class="p">:\</span><span class="n">Windows</span><span class="p">\</span><span class="n">System32</span><span class="p">\</span><span class="n">ole32</span><span class="p">.</span><span class="n">dll</span>
<a id="__codelineno-20-14" name="__codelineno-20-14" href="#__codelineno-20-14"></a><span class="c"># Notre point d&#39;arrêt est résolu</span>
<a id="__codelineno-20-15" name="__codelineno-20-15" href="#__codelineno-20-15"></a><span class="n">0</span><span class="p">:</span><span class="n">008</span><span class="p">&gt;</span> <span class="n">bl</span>
<a id="__codelineno-20-16" name="__codelineno-20-16" href="#__codelineno-20-16"></a>     <span class="n">0</span> <span class="n">e</span> <span class="n">Disable</span> <span class="nb">Clear </span> <span class="n">75fe1cd0</span>     <span class="n">0001</span> <span class="p">(</span><span class="n">0001</span><span class="p">)</span>  <span class="n">0</span><span class="p">:****</span> <span class="n">ole32</span><span class="p">!</span><span class="n">WriteStringStream</span>
</code></pre></div>
<h4 id="points-darrets-automatiques">Points d'arrêts automatiques</h4>
<p>Il est possible d'automatiser l'exécution de commande avec le debugger quand un point d'arrêt est déclenché.</p>
<p>Exemple, afficher le nombre de octets écrit dans un fichier à chaque fois qu'un point d'arrêt sur <code>kernel32!WriteFile</code> est déclenché :</p>
<ul>
<li>Utiliser la commande <code>.printf</code> avec le format <code>%p</code> pour afficher un pointeur</li>
<li>La commande <code>.echo</code> affiche l'output de <code>.printf</code> dans une fenêtre de WinDbg</li>
<li>On utilise <code>;</code> pour séparer les commandes</li>
<li>On affiche le contenu de <code>esp + 0x0C</code></li>
</ul>
<p>Prototype de <code>WriteFile</code> :</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-21-1" name="__codelineno-21-1" href="#__codelineno-21-1"></a><span class="n">BOOL</span><span class="w"> </span><span class="nf">WriteFile</span><span class="p">(</span>
<a id="__codelineno-21-2" name="__codelineno-21-2" href="#__codelineno-21-2"></a><span class="w">  </span><span class="n">HANDLE</span><span class="w">       </span><span class="n">hFile</span><span class="p">,</span>
<a id="__codelineno-21-3" name="__codelineno-21-3" href="#__codelineno-21-3"></a><span class="w">  </span><span class="n">LPCVOID</span><span class="w">      </span><span class="n">lpBuffer</span><span class="p">,</span>
<a id="__codelineno-21-4" name="__codelineno-21-4" href="#__codelineno-21-4"></a><span class="w">  </span><span class="n">DWORD</span><span class="w">        </span><span class="n">nNumberOfBytesToWrite</span><span class="p">,</span>
<a id="__codelineno-21-5" name="__codelineno-21-5" href="#__codelineno-21-5"></a><span class="w">  </span><span class="n">LPDWORD</span><span class="w">      </span><span class="n">lpNumberOfBytesWritten</span><span class="p">,</span>
<a id="__codelineno-21-6" name="__codelineno-21-6" href="#__codelineno-21-6"></a><span class="w">  </span><span class="n">LPOVERLAPPED</span><span class="w"> </span><span class="n">lpOverlapped</span>
<a id="__codelineno-21-7" name="__codelineno-21-7" href="#__codelineno-21-7"></a><span class="p">);</span>
</code></pre></div>
<ul>
<li>Chaque paramètre occupe 4 octets en mémoire dans la pile. <code>0x0C</code> correspond donc a 12 octets. Ce qui correspond au 3em argument de <code>WriteFile</code> qui est <code>nNumberOfBytesToWrite</code>, a savoir le nombre d'octets écrit</li>
<li>Windows x86 API utilise la convention d'appel <code>__stdcall</code> qui positionne les arguments dans la pile de droite à gauche</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-22-1" name="__codelineno-22-1" href="#__codelineno-22-1"></a><span class="n">bp</span> <span class="n">kernel32</span><span class="p">!</span><span class="n">WriteFile</span> <span class="s2">&quot;.printf \&quot;</span><span class="n">The</span> <span class="n">number</span> <span class="n">of</span> <span class="n">bytes</span> <span class="n">written</span> <span class="n">is</span><span class="p">:</span> <span class="k">%</span><span class="n">p</span><span class="p">\</span><span class="s2">&quot;, poi(esp + 0x0C);.echo;g&quot;</span>
</code></pre></div>
<p>Il est aussi possible de définir des points d'arrêt conditionnels. C'est-à-dire que l'exécution s'arrête uniquement si la condition est respectée.</p>
<p>Exemple, un point d'arrêt conditionnel sur <code>kernel32!WriteFile</code>. Le point d'arrêt sera déclenché et l'exécution stoppée seulement si l'on écrit exactement 4 octets :</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-23-1" name="__codelineno-23-1" href="#__codelineno-23-1"></a><span class="n">bp</span> <span class="n">kernel32</span><span class="p">!</span><span class="n">WriteFile</span> <span class="s2">&quot;.if (poi(esp + 0x0C) != 4) {gc} .else {.printf \&quot;</span><span class="n">The</span> <span class="n">number</span> <span class="n">of</span> <span class="n">bytes</span> <span class="n">written</span> <span class="n">is</span> <span class="n">4</span><span class="p">\</span><span class="s2">&quot;;.echo;}&quot;</span>
</code></pre></div>
<ul>
<li><code>gc</code> : <em>Go from Conditional Breakpoint</em></li>
</ul>
<h4 id="points-darrets-materiels">Points d'arrêts matériels</h4>
<p>Les points d'arrêts processeur ou matériel sont gérés par le CPU et stockés dans les registres de debug du CPU.</p>
<p>Il existe 6 registres de debug dans l'architecture <code>x86</code>, le nombre est donc limité par rapport aux points d'arrêts logiciels :</p>
<ul>
<li><code>DR0</code> à <code>DR03</code></li>
<li><code>DR06</code></li>
<li><code>DR07</code></li>
</ul>
<p>Les points d'arrêts matériels peuvent être définis avec la commande <code>ba</code> qui prend 3 arguments :</p>
<ul>
<li>1er : Type d'accès</li>
<li><code>e</code> : <code>execute</code></li>
<li><code>r</code> : <code>read</code></li>
<li><code>w</code> : <code>write</code></li>
<li>2em : Taille en octets pour l'accès mémoire indiqué</li>
<li>3em : Adresse mémoire où on veut mettre le point d'arrêt</li>
</ul>
<p>Point d'arrêt matériel sur l'exécution de l'API <code>WriteFile</code></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-24-1" name="__codelineno-24-1" href="#__codelineno-24-1"></a><span class="n">0</span><span class="p">:</span><span class="n">006</span><span class="p">&gt;</span> <span class="n">ba</span> <span class="n">e</span> <span class="n">1</span> <span class="n">kernel32</span><span class="p">!</span><span class="n">WriteFile</span>
<a id="__codelineno-24-2" name="__codelineno-24-2" href="#__codelineno-24-2"></a><span class="n">0</span><span class="p">:</span><span class="n">006</span><span class="p">&gt;</span> <span class="n">g</span>
</code></pre></div>
<p>La finalité est la même qu'un point d'arrêt logiciel. Mais la on utilise les registres de debug du CPU plutôt que d'altérer le code avec des instructions <code>INT 3</code>.</p>
<p>On définit un point d'arrêt matériel en <code>write</code> sur les <code>2</code> premier octet du <em>string</em> <code>Unicode</code> (<code>0x00</code> et <code>0x77</code>) sur l'adresse mémoire <code>00a99b68</code> :</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-25-1" name="__codelineno-25-1" href="#__codelineno-25-1"></a><span class="n">0</span><span class="p">:</span><span class="n">006</span><span class="p">&gt;</span> <span class="n">ba</span> <span class="n">w</span> <span class="n">2</span> <span class="n">00a99b68</span>
<a id="__codelineno-25-2" name="__codelineno-25-2" href="#__codelineno-25-2"></a><span class="n">0</span><span class="p">:</span><span class="n">006</span><span class="p">&gt;</span> <span class="n">bl</span>
<a id="__codelineno-25-3" name="__codelineno-25-3" href="#__codelineno-25-3"></a>     <span class="n">0</span> <span class="n">e</span> <span class="n">Disable</span> <span class="nb">Clear </span> <span class="n">00a99b68</span> <span class="n">w</span> <span class="n">2</span> <span class="n">0001</span> <span class="p">(</span><span class="n">0001</span><span class="p">)</span>  <span class="n">0</span><span class="p">:****</span> 
</code></pre></div>
<p>Les points d'arrêt matériel sont utiles pour trouver ou les données sont prises en charge durant l'exécution.</p>
<p>Savoir les différencier et les utiliser :</p>
<ul>
<li>Avec un point d'arrêt logiciel, il aurait fallu trouver l'endroit ou il allait y avoir la modification</li>
<li>Avec un point d'arrêt matériel, on a pas besoin de connaitre l'endroit ou la modification se fait. On peut juste déclencher quand elle arrive et donc trouver l'endroit ou la modification est faite.</li>
</ul>
<h3 id="lister-les-modules">Lister les modules</h3>
<p>On peut afficher les modules chargés dans l'espace mémoire du processus avec la commande <code>lm</code> :</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-26-1" name="__codelineno-26-1" href="#__codelineno-26-1"></a><span class="n">0</span><span class="p">:</span><span class="n">000</span><span class="p">&gt;</span> <span class="n">lm</span>
<a id="__codelineno-26-2" name="__codelineno-26-2" href="#__codelineno-26-2"></a><span class="nb">start </span>   <span class="k">end</span>        <span class="n">module</span> <span class="n">name</span>
<a id="__codelineno-26-3" name="__codelineno-26-3" href="#__codelineno-26-3"></a><span class="n">010a0000</span> <span class="n">010df000</span>   <span class="n">NOTEPAD</span>    <span class="p">(</span><span class="n">deferred</span><span class="p">)</span>             
<a id="__codelineno-26-4" name="__codelineno-26-4" href="#__codelineno-26-4"></a><span class="n">584f0000</span> <span class="n">5856a000</span>   <span class="n">DUser</span>      <span class="p">(</span><span class="n">deferred</span><span class="p">)</span>             
<a id="__codelineno-26-5" name="__codelineno-26-5" href="#__codelineno-26-5"></a><span class="n">58570000</span> <span class="n">586df000</span>   <span class="n">DUI70</span>      <span class="p">(</span><span class="n">deferred</span><span class="p">)</span>             
<a id="__codelineno-26-6" name="__codelineno-26-6" href="#__codelineno-26-6"></a><span class="p">[...]</span>
</code></pre></div>
<p>On peut lister les modules en filtrant avec <code>*</code>.  On affiche ici les modules qui commencent par <code>kernel</code> :</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-27-1" name="__codelineno-27-1" href="#__codelineno-27-1"></a><span class="n">0</span><span class="p">:</span><span class="n">000</span><span class="p">&gt;</span> <span class="n">lm</span> <span class="n">m</span> <span class="n">kernel</span><span class="p">*</span>
<a id="__codelineno-27-2" name="__codelineno-27-2" href="#__codelineno-27-2"></a><span class="n">Browse</span> <span class="n">full</span> <span class="n">module</span> <span class="n">list</span>
<a id="__codelineno-27-3" name="__codelineno-27-3" href="#__codelineno-27-3"></a><span class="nb">start </span>   <span class="k">end</span>        <span class="n">module</span> <span class="n">name</span>
<a id="__codelineno-27-4" name="__codelineno-27-4" href="#__codelineno-27-4"></a><span class="n">74220000</span> <span class="n">7422e000</span>   <span class="n">kernel_appcore</span>
<a id="__codelineno-27-5" name="__codelineno-27-5" href="#__codelineno-27-5"></a><span class="n">74540000</span> <span class="n">74718000</span>   <span class="n">KERNELBASE</span>
<a id="__codelineno-27-6" name="__codelineno-27-6" href="#__codelineno-27-6"></a><span class="n">77710000</span> <span class="n">777a5000</span>   <span class="n">KERNEL32</span>
</code></pre></div>
<h3 id="operations-mathematiques">Opérations mathématiques</h3>
<p>On utilise l'opérateur <code>?</code> pour gérer les expressions mathématiques :</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-28-1" name="__codelineno-28-1" href="#__codelineno-28-1"></a><span class="n">0</span><span class="p">:</span><span class="n">000</span><span class="p">&gt;</span> <span class="p">?</span> <span class="n">74663bcf</span> <span class="p">-</span> <span class="n">746bd888</span>
<a id="__codelineno-28-2" name="__codelineno-28-2" href="#__codelineno-28-2"></a><span class="n">Evaluate</span> <span class="n">expression</span><span class="p">:</span> <span class="p">-</span><span class="n">367801</span> <span class="p">=</span> <span class="n">fffa6347</span>
</code></pre></div>
<h3 id="formats-de-donnees">Formats de données</h3>
<p>L'affichage par défaut est hexadécimal. Mais il est possible de demander un autre format :</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-29-1" name="__codelineno-29-1" href="#__codelineno-29-1"></a><span class="c"># Hexa</span>
<a id="__codelineno-29-2" name="__codelineno-29-2" href="#__codelineno-29-2"></a><span class="c">## h`41414141` = d`1094795585`</span>
<a id="__codelineno-29-3" name="__codelineno-29-3" href="#__codelineno-29-3"></a><span class="n">0</span><span class="p">:</span><span class="n">000</span><span class="p">&gt;</span> <span class="p">?</span> <span class="n">41414141</span>
<a id="__codelineno-29-4" name="__codelineno-29-4" href="#__codelineno-29-4"></a><span class="n">Evaluate</span> <span class="n">expression</span><span class="p">:</span> <span class="n">1094795585</span> <span class="p">=</span> <span class="n">41414141</span>
<a id="__codelineno-29-5" name="__codelineno-29-5" href="#__codelineno-29-5"></a><span class="c"># Hexa -&gt; Decimal</span>
<a id="__codelineno-29-6" name="__codelineno-29-6" href="#__codelineno-29-6"></a><span class="c"># d`41414141` = h`0277edfd`</span>
<a id="__codelineno-29-7" name="__codelineno-29-7" href="#__codelineno-29-7"></a><span class="n">0</span><span class="p">:</span><span class="n">000</span><span class="p">&gt;</span> <span class="p">?</span> <span class="n">0n41414141</span>
<a id="__codelineno-29-8" name="__codelineno-29-8" href="#__codelineno-29-8"></a><span class="n">Evaluate</span> <span class="n">expression</span><span class="p">:</span> <span class="n">41414141</span> <span class="p">=</span> <span class="n">0277edfd</span>
<a id="__codelineno-29-9" name="__codelineno-29-9" href="#__codelineno-29-9"></a><span class="c"># Binary to Decimal to Hexa</span>
<a id="__codelineno-29-10" name="__codelineno-29-10" href="#__codelineno-29-10"></a><span class="c">## b`1110100110111` = d`7479` = h`00001d37`</span>
<a id="__codelineno-29-11" name="__codelineno-29-11" href="#__codelineno-29-11"></a><span class="n">0</span><span class="p">:</span><span class="n">000</span><span class="p">&gt;</span> <span class="p">?</span> <span class="n">0y1110100110111</span>
<a id="__codelineno-29-12" name="__codelineno-29-12" href="#__codelineno-29-12"></a><span class="n">Evaluate</span> <span class="n">expression</span><span class="p">:</span> <span class="n">7479</span> <span class="p">=</span> <span class="n">00001d37</span>
</code></pre></div>
<p>On peut utiliser <code>.formats</code> pour convertir en plusieurs types</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-30-1" name="__codelineno-30-1" href="#__codelineno-30-1"></a><span class="n">0</span><span class="p">:</span><span class="n">000</span><span class="p">&gt;</span> <span class="p">.</span><span class="n">formats</span> <span class="n">41414141</span>
<a id="__codelineno-30-2" name="__codelineno-30-2" href="#__codelineno-30-2"></a><span class="n">Evaluate</span> <span class="n">expression</span><span class="p">:</span>
<a id="__codelineno-30-3" name="__codelineno-30-3" href="#__codelineno-30-3"></a>  <span class="n">Hex</span><span class="p">:</span>     <span class="n">41414141</span>
<a id="__codelineno-30-4" name="__codelineno-30-4" href="#__codelineno-30-4"></a>  <span class="n">Decimal</span><span class="p">:</span> <span class="n">1094795585</span>
<a id="__codelineno-30-5" name="__codelineno-30-5" href="#__codelineno-30-5"></a>  <span class="n">Octal</span><span class="p">:</span>   <span class="n">10120240501</span>
<a id="__codelineno-30-6" name="__codelineno-30-6" href="#__codelineno-30-6"></a>  <span class="n">Binary</span><span class="p">:</span>  <span class="n">01000001</span> <span class="n">01000001</span> <span class="n">01000001</span> <span class="n">01000001</span>
<a id="__codelineno-30-7" name="__codelineno-30-7" href="#__codelineno-30-7"></a>  <span class="n">Chars</span><span class="p">:</span>   <span class="n">AAAA</span>
<a id="__codelineno-30-8" name="__codelineno-30-8" href="#__codelineno-30-8"></a>  <span class="n">Time</span><span class="p">:</span>    <span class="n">Thu</span> <span class="n">Sep</span>  <span class="n">9</span> <span class="n">22</span><span class="p">:</span><span class="n">53</span><span class="p">:</span><span class="n">05</span> <span class="n">2004</span>
<a id="__codelineno-30-9" name="__codelineno-30-9" href="#__codelineno-30-9"></a>  <span class="n">Float</span><span class="p">:</span>   <span class="n">low</span> <span class="n">12</span><span class="p">.</span><span class="n">0784</span> <span class="n">high</span> <span class="n">0</span>
<a id="__codelineno-30-10" name="__codelineno-30-10" href="#__codelineno-30-10"></a>  <span class="n">Double</span><span class="p">:</span>  <span class="n">5</span><span class="p">.</span><span class="n">40901e</span><span class="p">-</span><span class="n">315</span>
</code></pre></div>
<h2 id="les-protections-memoire">Les protections mémoire</h2>
<p>Plusieurs mécanismes mis en oeuvre dans les systèmes Windows peuvent rendre la prise de contrôle de <code>EIP</code> plus complexe.</p>
<p>Ces contrôles doivent être actifs à la compilation pour être pris en compte durant l'exploitation</p>
<h3 id="data-execution-prevention">Data Execution Prevention</h3>
<p><code>Data Execution Prevention</code> (<code>DEP</code>) : Préviens l'exécution de code depuis les page <code>data</code> en levant une exception quand une tentative est faite</p>
<h3 id="aslr">ASLR</h3>
<p><code>Address Space Layout Randomization</code> (<code>ASLR</code>) : Randomise les adresses de base des applications chargées et des DLL a chaque redémarrage de l'OS.</p>
<p>Dans les OS comme XP sans ASLR toutes les DLL sont chargées systématiquement à la même adresse mémoire ce qui facilite l'exploitation.</p>
<h3 id="cfg">CFG</h3>
<p><code>Control Flow Guard</code> (<code>CFG</code>) : Implémentation de Microsoft du <em>Control Flow Integrity</em>. Ce mécanisme contrôle les <em>indirect code branching</em>. Utilisation de <code>call &lt;instruction&gt;</code> utilisant un registre tel que <code>call EAX</code> comme opérande plutôt qu'une adresse mémoire.</p>
<p>Préviens la réécriture de pointeur de fonction dans des exploits.</p>







  
    
  
  


  <aside class="md-source-file">
    
      
  <span class="md-source-file__fact">
    <span class="md-icon" title="Last update">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M21 13.1c-.1 0-.3.1-.4.2l-1 1 2.1 2.1 1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-1.9 1.8-6.1 6V23h2.1l6.1-6.1zM12.5 7v5.2l4 2.4-1 1L11 13V7zM11 21.9c-5.1-.5-9-4.8-9-9.9C2 6.5 6.5 2 12 2c5.3 0 9.6 4.1 10 9.3-.3-.1-.6-.2-1-.2s-.7.1-1 .2C19.6 7.2 16.2 4 12 4c-4.4 0-8 3.6-8 8 0 4.1 3.1 7.5 7.1 7.9l-.1.2z"/></svg>
    </span>
    <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date" title="May 31, 2025 19:44:57 UTC">May 31, 2025</span>
  </span>

    
    
    
    
  </aside>





                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../..", "features": ["content.code.copy", "content.tooltips", "navigation.tracking", "navigation.top", "search.share", "search.suggest"], "search": "../../assets/javascripts/workers/search.d50fe291.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.13a4f30d.min.js"></script>
      
    
  </body>
</html>